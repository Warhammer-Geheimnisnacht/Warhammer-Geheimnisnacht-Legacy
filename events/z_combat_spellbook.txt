namespace = z_combat_spell_menu
character_event = {
    id = z_combat_spell_menu.1
    is_triggered_only = yes
    hide_window = yes
    immediate = {
        event_target:magic_caster = {
            magic_xp_counter = yes
            magic_points_setup = yes
            magic_spells_known = yes
        }
        character_event = { id = z_combat_spell_menu.0}
    }

}

character_event = {
    id = z_combat_spell_menu.0
    is_triggered_only = yes
    hide_window = yes

    immediate = {
        event_target:magic_caster = {
            magic_spells_known = yes
            set_variable = { which = "dnum" value = "0"}
        }
        event_target:magic_caster = {
            set_variable = { which  = "action_nr" value = "0" }
            set_variable = { which = "action_picked" value = "1" }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_high_magic_caster = yes
                    #in_command = yes
                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"}
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_hm_drain" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_high_magic_caster = yes
                    #in_command = yes
                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"}
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_hm_soul_quench" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_high_magic_caster = yes
                    #in_command = yes
                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2"}
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_hm_apotheoisis" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    #in_command = yes
                    z_lore_of_high_magic_caster = yes
                    check_variable = { which = "spellknownlvl" value = "3"}
                    check_variable = { which = "spell_power" value = "3"  }
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_hm_firey_convocation" which = "action_nr" }
            }
        }

        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_high_magic_caster = yes
                    trait = creature_slann
                    check_variable = { which = "spellknownlvl" value = "4"}
                    check_variable = { which = "spell_power" value = "3"  }
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_hm_transcendant_casting" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_dark_magic
                    #in_command = yes
                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"}
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_dm_doombolt" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_dark_magic
                    #in_command = yes
                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2"}
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_dm_dark_fury" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_dark_magic
                    #in_command = yes
                    check_variable = { which = "spellknownlvl" value = "3"}
                    check_variable = { which = "spell_power" value = "3"}
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_dm_bladewind" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    #in_command = yes
                    trait = lore_dark_magic
                    check_variable = { which = "spellknownlvl" value = "4"}
                    check_variable = { which = "spell_power" value = "4" }
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_dm_black_horror" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_heavens_caster = yes

                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_he_foresight" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_heavens_caster = yes

                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_he_urannons_thunderbolt" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_heavens_caster = yes

                    check_variable = { which = "spellknownlvl" value = "3"}
                    check_variable = { which = "spell_power" value = "3"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_he_chain_lightning" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_heavens_caster = yes

                    check_variable = { which = "spellknownlvl" value = "4"}
                    check_variable = { which = "spell_power" value = "4"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_he_comet" which = "action_nr" }
            }
        }

        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_beasts_caster = yes

                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_bt_wrath_of_the_wild" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_beasts_caster = yes

                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_bt_beasts_gone_wild" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_beasts_caster = yes

                    check_variable = { which = "spellknownlvl" value = "3"}
                    check_variable = { which = "spell_power" value = "3"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_bt_beasts_of_the_wild" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_beasts_caster = yes

                    check_variable = { which = "spellknownlvl" value = "4"}
                    check_variable = { which = "spell_power" value = "4"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_bt_amber_spear" which = "action_nr" }
            }
        }

        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_metal_caster = yes
                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_mt_flesh_to_gold" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_metal_caster = yes
                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2"}
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_mt_weight_of_iron" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_metal_caster = yes
                    check_variable = { which = "spellknownlvl" value = "3"}
                    check_variable = { which = "spell_power" value = "3"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_mt_Curse_of_Rust" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_metal_caster = yes
                    check_variable = { which = "spellknownlvl" value = "4"}
                    check_variable = { which = "spell_power" value = "4"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_mt_blessings_of_steel" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_life_caster = yes
                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_lf_grasping_vine" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_life_caster = yes
                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_lf_Life_blossom" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_life_caster = yes
                    check_variable = { which = "spellknownlvl" value = "3"}
                    check_variable = { which = "spell_power" value = "3"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_lf_Overgrowth" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_life_caster = yes
                    check_variable = { which = "spellknownlvl" value = "4"}
                    check_variable = { which = "spell_power" value = "4"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_lf_resurrection" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_fire_caster = yes
                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_fi_fireball" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_fire_caster = yes
                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_fi_burning_blade" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_fire_caster = yes
                    check_variable = { which = "spellknownlvl" value = "3"}
                    check_variable = { which = "spell_power" value = "3"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_fi_blast_of_flame" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_fire_caster = yes
                    check_variable = { which = "spellknownlvl" value = "4"}
                    check_variable = { which = "spell_power" value = "4"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_fi_firestorm" which = "action_nr" }
            }
        }

        #Shadow lore Battle Magic
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_shadows_caster = yes
                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_sh_shadow_bolt" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_shadows_caster = yes
                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_sh_steed_of_shadows" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_shadows_caster = yes
                    check_variable = { which = "spellknownlvl" value = "3"}
                    check_variable = { which = "spell_power" value = "3"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_sh_mortal_terror" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_shadows_caster = yes
                    check_variable = { which = "spellknownlvl" value = "4"}
                    check_variable = { which = "spell_power" value = "4"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_sh_wave_of_darkness" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_death_caster = yes
                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_dt_lore_death_bolt" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_death_caster = yes
                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_dt_lore_ward_of_death" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_death_caster = yes
                    check_variable = { which = "spellknownlvl" value = "3"}
                    check_variable = { which = "spell_power" value = "3"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_dt_lore_deaths_majesty" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_death_caster = yes
                    check_variable = { which = "spellknownlvl" value = "4"}
                    check_variable = { which = "spell_power" value = "4"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_dt_lore_black_sphere" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_death_caster = yes
                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_dt_lore_curse_of_infirmity" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_death_caster = yes
                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_dt_lore_stopper_of_death" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_death_caster = yes
                    check_variable = { which = "spellknownlvl" value = "3"}
                    check_variable = { which = "spell_power" value = "3"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_dt_lore_banish_death" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_death_caster = yes
                    check_variable = { which = "spellknownlvl" value = "4"}
                    check_variable = { which = "spell_power" value = "4"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_dt_lore_deathly_curse" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_light_caster = yes
                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_li_holy_fire" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_light_caster = yes
                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_li_speed_of_light" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_light_caster = yes
                    check_variable = { which = "spellknownlvl" value = "3"}
                    check_variable = { which = "spell_power" value = "3"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_li_Wall_of_light" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    z_lore_of_light_caster = yes
                    check_variable = { which = "spellknownlvl" value = "4"}
                    check_variable = { which = "spell_power" value = "4"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_li_Light_of_the_Heavens" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_waaagh
                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_or_sneaky_stabbin" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_waaagh

                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_or_eare_we_go" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_waaagh
                    check_variable = { which = "spellknownlvl" value = "3"}
                    check_variable = { which = "spell_power" value = "3"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_or_morkll_fix_it" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_waaagh
                    check_variable = { which = "spellknownlvl" value = "4"}
                    check_variable = { which = "spell_power" value = "4"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_or_foot_of_gork" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_necromancy
                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_ne_imbide_life" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_necromancy
                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_ne_unholy_life" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_necromancy
                    check_variable = { which = "spellknownlvl" value = "3"}
                    check_variable = { which = "spell_power" value = "3"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_ne_unholy_resolve" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_necromancy
                    check_variable = { which = "spellknownlvl" value = "4"}
                    check_variable = { which = "spell_power" value = "4"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_ne_damnation_of_the_dead" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_nurgle
                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_nu_bolt_of_rot" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_nurgle
                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2" }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_nu_embrace" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_nurgle
                    check_variable = { which = "spellknownlvl" value = "3"}
                    check_variable = { which = "spell_power" value = "3"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_nu_Plague_bearers" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_nurgle
                    check_variable = { which = "spellknownlvl" value = "4"}
                    check_variable = { which = "spell_power" value = "4"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_nu_Maw_of_disease" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_slaanesh
                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_sl_Unholy_Screaming" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_slaanesh
                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_sl_wailing_madness" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_slaanesh
                    check_variable = { which = "spellknownlvl" value = "3"}
                    check_variable = { which = "spell_power" value = "3"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_sl_daemonettes" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_slaanesh
                    check_variable = { which = "spellknownlvl" value = "4"}
                    check_variable = { which = "spell_power" value = "4"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_sl_choir" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_tzeentch
                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_te_bolt_of_change" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_tzeentch
                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_te_flames_of_mutation" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_tzeentch
                    check_variable = { which = "spellknownlvl" value = "3"}
                    check_variable = { which = "spell_power" value = "3"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_te_screamers" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_tzeentch
                    check_variable = { which = "spellknownlvl" value = "4"}
                    check_variable = { which = "spell_power" value = "4"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_te_twisting_paths" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_ice
                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_ie_1" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_ice
                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                change_variable = { which = "lore_ice" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_ice
                    check_variable = { which = "spellknownlvl" value = "3"}
                    check_variable = { which = "spell_power" value = "3"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                change_variable = { which = "lore_ice" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = lore_ice
                    check_variable = { which = "spellknownlvl" value = "4"}
                    check_variable = { which = "spell_power" value = "4"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                change_variable = { which = "lore_ice" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    or = {
                        trait = lore_vermin
                        trait = warlock_engineer
                    }
                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_ru_warp_lightning" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    or = {
                        trait = lore_vermin
                        trait = warlock_engineer
                    }                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_ru_cracks_of_doom" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    or = {
                        trait = lore_vermin
                        trait = warlock_engineer
                    }                    check_variable = { which = "spellknownlvl" value = "1"}
                    check_variable = { which = "spell_power" value = "1"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_ru_Breath_of_Pestilence" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    or = {
                        trait = lore_vermin
                        trait = warlock_engineer
                    }
                    check_variable = { which = "spellknownlvl" value = "2"}
                    check_variable = { which = "spell_power" value = "2"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_ru_Vermintide" which = "action_nr" }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    trait = grey_seer
                    check_variable = { which = "spellknownlvl" value = "6"}
                    check_variable = { which = "spell_power" value = "6"  }
                    #in_command = yes
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_nr" value = "1" }
                set_variable = { which = "m_ru_13_spell" which = "action_nr" }
            }
        }
        long_character_event = { id = z_combat_spell_menu.2}
    }
}

long_character_event = {
    id = z_combat_spell_menu.2
    title = z_combat_spell_menu.2
    desc = "z_combat_spell_menu.2_desc"
    picture = "GFX_evt_mage_choose_lore"
    is_triggered_only = yes
    trigger = {
        event_target:magic_caster = {
            is_alive = yes
        }
    }
    # next action
    option = {
        name = "NEXT_ACTION"
        if = {
            limit = {
                event_target:magic_caster = {
                    NOT = {
                        is_variable_equal = { which = "action_picked" which = "action_nr" }
                    }
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_picked" value = "1" }
            }
            hidden_tooltip = { repeat_event = { id = z_combat_spell_menu.2 }}
            break = yes
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    is_variable_equal = { which = "action_picked" which = "action_nr" }
                }
            }
            event_target:magic_caster = {
                set_variable = { which = "action_picked" value = "1" } # circular menu
            }
            hidden_tooltip = { repeat_event = { id = z_combat_spell_menu.2 }}
            break = yes
        }
        ai_chance = { factor = 1 }
    }
    # previous action
    option = {
        name = "PREVIOUS_ACTION"

        if = {
            limit = {
                event_target:magic_caster = {
                    NOT = {
                        is_variable_equal = { which = "action_picked" value = "1" }
                    }
                }
            }
            event_target:magic_caster = {
                change_variable = { which = "action_picked" value = "-1" }
            }
            hidden_tooltip = { repeat_event = { id = z_combat_spell_menu.2 }}
            break = yes
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    is_variable_equal = { which = "action_picked" value = "1" }
                }
            }
            event_target:magic_caster = {
                set_variable = { which = "action_picked" which = "action_nr" } # circular menu
            }
            hidden_tooltip = { repeat_event = { id = z_combat_spell_menu.2 }}
            break = yes
        }
        ai_chance = { factor = 0 }
    }
    option = {
        name = "high_magic_lore.2a"
        custom_tooltip = {
            text = "high_magic_lore.2a_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_hm_drain" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "6"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}

        ai_chance = {
            factor = 1
        }
    }
    option = {
        name = "high_magic_lore.2b"
        custom_tooltip = {
            text = "high_magic_lore.2b_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_hm_soul_quench" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "7"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 1 }
    }
    option = {
        name = "high_magic_lore.2c"
        custom_tooltip = {
            text = "high_magic_lore.2c_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_hm_apotheoisis" }
                check_variable = { which = "spell_power" value = "2"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "9"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 2 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 1 }
    }
    option = {
        name = "high_magic_lore.2d"
        custom_tooltip = {
            text = "high_magic_lore.2d_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_hm_firey_convocation" }
                check_variable = { which = "spell_power" value = "3"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "20"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 1 }
    }
    option = {
        name = "high_magic.2z"
        custom_tooltip = {
            text = "high_magic.2z_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_hm_transcendant_casting" }
                check_variable = { which = "spell_power" value = "3"}
            }
        }
        character_event = { id = high_magic_lore.4000}
        ai_chance = { factor = 1 }
    }
    #Heavens Lore Combat Magics
    option = {
        name = "heavens_lore.2a"
        custom_tooltip = {
            text = "heavens_lore.2a_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_he_foresight" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "7"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 1 }
    }
    option = {
        name = "heavens_lore.2b"
        custom_tooltip = {
            text = "heavens_lore.2b_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_he_urannons_thunderbolt" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "9"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 2 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 1 }
    }
    option = {
        name = "heavens_lore.2c"
        custom_tooltip = {
            text = "heavens_lore.2c_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_he_chain_lightning" }
                check_variable = { which = "spell_power" value = "2"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "15"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 1 }
    }
    option = {
        name = "heavens_lore.2d"
        custom_tooltip = {
            text = "heavens_lore.2d_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_he_comet" }
                check_variable = { which = "spell_power" value = "4"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "20"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 4 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 1 }
    }
    #Beast Lore
    option = {
        name = "beasts_lore.2a"
        custom_tooltip = {
            text = "beasts_lore.2a_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_bt_wrath_of_the_wild" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "7"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = {
            factor = 1
        }
    }
    option = {
        name = "beasts_lore.2b"
        custom_tooltip = {
            text = "beasts_lore.2b_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_bt_beasts_gone_wild" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "17"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 1 }
    }
    option = {
        name = "beasts_lore.2c"
        custom_tooltip = {
            text = "beasts_lore.2c_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_bt_beasts_of_the_wild" }
                check_variable = { which = "spell_power" value = "3"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "15"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 1 }
    }
    option = {
        name = "beasts_lore.2d"
        custom_tooltip = {
            text = "beasts_lore.2d_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_bt_amber_spear" }
                check_variable = { which = "spell_power" value = "4"}
            }
        }

        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "20"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 4 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 1 }
    }
    #Light Lore combat
    option = {
        name = "light_lore.2a"
        custom_tooltip = {
            text = "light_lore.2a_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_li_holy_fire" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "7"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "light_lore.2b"
        custom_tooltip = {
            text = "light_lore.2b_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_li_speed_of_light" }
                check_variable = { which = "spell_power" value = "2"}
            }
        }
        event_target:magic_caster = {
            change_variable = {which = "spell_power" value = -2}
            set_variable = {which = "spellcast" value = "12"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 2 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "light_lore.2c"
        custom_tooltip = {
            text = "light_lore.2c_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_li_Wall_of_light" }
                check_variable = { which = "spell_power" value = "3"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "18"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "light_lore.2d"
        custom_tooltip = {
            text = "light_lore.2d_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_li_Light_of_the_Heavens" }
                check_variable = { which = "spell_power" value = "4"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "21"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 4 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }#Shadows Lore
    option = {
        name = "shadows_lore.2a"
        custom_tooltip = {
            text = "shadows_lore.2a_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_sh_shadow_bolt" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "7"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "shadows_lore.2b"
        custom_tooltip = {
            text = "shadows_lore.2b_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_sh_steed_of_shadows" }
                check_variable = { which = "spell_power" value = "2"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "11"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 2 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "shadows_lore.2c"
        custom_tooltip = {
            text = "shadows_lore.2c_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_sh_mortal_terror" }
                check_variable = { which = "spell_power" value = "3"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "14"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "shadows_lore.2d"
        custom_tooltip = {
            text = "shadows_lore.2d_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_sh_wave_of_darkness" }
                check_variable = { which = "spell_power" value = "4"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "18"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 4 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    #Life Lore
    option = {
        name = "life_lore.2a"
        custom_tooltip = {
            text = "life_lore.2a_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_lf_grasping_vine" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "7"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "life_lore.2b"
        custom_tooltip = {
            text = "life_lore.2b_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_lf_Life_blossom" }
                check_variable = { which = "spell_power" value = "2"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "12"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 2 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "life_lore.2c"
        custom_tooltip = {
            text = "life_lore.2c_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_lf_Overgrowth" }
                check_variable = { which = "spell_power" value = "3"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "20"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "life_lore.2d"
        custom_tooltip = {
            text = "life_lore.2d_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_lf_resurrection" }
                check_variable = { which = "spell_power" value = "4"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "30"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 4 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    #Death lore
    option = {
        name = "death_lore.2a"
        custom_tooltip = {
            text = "death_lore.2a_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_dt_lore_death_bolt" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "7"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "death_lore.2b"
        custom_tooltip = {
            text = "death_lore.2b_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_dt_lore_ward_of_death" }
                check_variable = { which = "spell_power" value = "2"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "13"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 2 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "death_lore.2c"
        custom_tooltip = {
            text = "death_lore.2c_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_dt_lore_deaths_majesty" }
                check_variable = { which = "spell_power" value = "3"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "18"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "death_lore.2d"
        custom_tooltip = {
            text = "death_lore.2d_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_dt_lore_black_sphere" }
                check_variable = { which = "spell_power" value = "4"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "28"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 4 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    #Fire Lore
    option = {
        name = "fire_lore.2a"
        custom_tooltip = {
            text = "fire_lore.2a_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_fi_fireball" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "7"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "fire_lore.2b"
        custom_tooltip = {
            text = "fire_lore.2b_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_fi_burning_blade" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "7"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "fire_lore.2c"
        custom_tooltip = {
            text = "fire_lore.2c_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_fi_blast_of_flame" }
                check_variable = { which = "spell_power" value = "2"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "15"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "fire_lore.2d"
        custom_tooltip = {
            text = "fire_lore.2d_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_fi_firestorm" }
                check_variable = { which = "spell_power" value = "4"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "25"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 4 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    #Metal Lore Combat Magics
    option = {
        name = "metal_lore.2a"
        custom_tooltip = {
            text = "metal_lore.2a_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_mt_flesh_to_gold" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "7"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "metal_lore.2b"
        custom_tooltip = {
            text = "metal_lore.2b_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_mt_weight_of_iron" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "7"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "metal_lore.2c"
        custom_tooltip = {
            text = "metal_lore.2c_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_mt_Curse_of_Rust" }
                check_variable = { which = "spell_power" value = "3"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "17"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "metal_lore.2d"
        custom_tooltip = {
            text = "metal_lore.2d_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_mt_blessings_of_steel" }
                check_variable = { which = "spell_power" value = "4"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "25"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 4 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    #Dark Lore
    option = {
        name = "dark_magic_lore.2a"
        custom_tooltip = {
            text = "dark_magic_lore.2a_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_dm_doombolt" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "7"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "dark_magic_lore.2b"
        custom_tooltip = {
            text = "dark_magic_lore.2b_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_dm_dark_fury" }
                check_variable = { which = "spell_power" value = "2"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "12"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 2 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "dark_magic_lore.2c"
        custom_tooltip = {
            text = "dark_magic_lore.2c_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_dm_bladewind" }
                check_variable = { which = "spell_power" value = "3"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "18"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "dark_magic_lore.2d"
        custom_tooltip = {
            text = "dark_magic_lore.2d_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_dm_black_horror" }
                check_variable = { which = "spell_power" value = "4"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "24"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }



    option = {
        name = "ruin_lore.2a"
        custom_tooltip = {
            text = "ruin_lore.2a_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_ru_warp_lightning" }
                check_variable = { which = "spell_power" value = "1"}
                not = {
                    trait = plaguelord
                }
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "9"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "ruin_lore.2b"
        custom_tooltip = {
            text = "ruin_lore.2b_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_ru_cracks_of_doom" }
                check_variable = { which = "spell_power" value = "2"}
                not = {
                    trait = plaguelord
                }
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "12"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 2 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "ruin_lore.2c"
        custom_tooltip = {
            text = "ruin_lore.2c_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_ru_Breath_of_Pestilence" }
                check_variable = { which = "spell_power" value = "1"}
                not = {
                    trait = warlock_engineer
                }
            }
        }
        event_target:magic_caster = {
            change_variable = {which = "spell_power" value = -1}
            set_variable = {which = "spellcast" value = "7"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "ruin_lore.2d"
        custom_tooltip = {
            text = "ruin_lore.2d_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_ru_Vermintide" }
                check_variable = { which = "spell_power" value = "3"}
                not = {
                    trait = warlock_engineer
                }
            }
        }
        event_target:magic_caster = {
            change_variable = {which = "spell_power" value = -3}
            set_variable = {which = "spellcast" value = "12"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 2 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "ruin_lore.2e"
        custom_tooltip = {
            text = "ruin_lore.2e_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_ru_13_spell" }
                check_variable = { which = "spell_power" value = "8"}
                trait = grey_seer
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "45"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 8 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "necromancy_lore.2a"
        custom_tooltip = {
            text = "necromancy_lore.2a_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_ne_imbide_life" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "7"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "necromancy_lore.2b"
        custom_tooltip = {
            text = "necromancy_lore.2b_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_ne_unholy_life" }
                check_variable = { which = "spell_power" value = "2"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "13"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 2 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "necromancy_lore.2c"
        custom_tooltip = {
            text = "necromancy_lore.2c_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_ne_unholy_resolve" }
                check_variable = { which = "spell_power" value = "3"}
            }
        }
        event_target:magic_caster = {
            change_variable = {which = "spell_power" value = -3}
            set_variable = {which = "spellcast" value = "19"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "necromancy_lore.2d"
        custom_tooltip = {
            text = "necromancy_lore.2d_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_ne_damnation_of_the_dead" }
                check_variable = { which = "spell_power" value = "4"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "25"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "orc_lore.2a"
        custom_tooltip = {
            text = "orc_lore.2a_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_or_eare_we_go" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "7"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "orc_lore.2b"
        custom_tooltip = {
            text = "orc_lore.2b_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_or_sneaky_stabbin" }
                check_variable = { which = "spell_power" value = "2"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "13"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 2 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "orc_lore.2c"
        custom_tooltip = {
            text = "orc_lore.2c_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_or_morkll_fix_it" }
                check_variable = { which = "spell_power" value = "3"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "19"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "orc_lore.2d"
        custom_tooltip = {
            text = "orc_lore.2d_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_or_foot_of_gork" }
                check_variable = { which = "spell_power" value = "4"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "25"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 4 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "ice_lore.2a"
        custom_tooltip = {
            text = "ice_lore.2a_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_ie_1" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "7"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "ice_lore.2b"
        custom_tooltip = {
            text = "ice_lore.2b_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_ie_2" }
                check_variable = { which = "spell_power" value = "2"}
            }
        }
        event_target:magic_caster = {
            change_variable = {which = "spell_power" value = -2}
            set_variable = {which = "spellcast" value = "13"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 2 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "ice_lore.2c"
        custom_tooltip = {
            text = "ice_lore.2c_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_ie_3" }
                check_variable = { which = "spell_power" value = "3"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "19"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "ice_lore.2d"
        custom_tooltip = {
            text = "ice_lore.2d_desc"
        }
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_ie_4" }
                check_variable = { which = "spell_power" value = "4"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "25"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "nurgle_lore.2a"
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_nu_bolt_of_rot" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "7"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "nurgle_lore.2b"
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_nu_embrace" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "9"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "nurgle_lore.2c"
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_nu_Plague_bearers" }
                check_variable = { which = "spell_power" value = "2"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "12"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 2 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "nurgle_lore.2d"
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_nu_Maw_of_disease" }
                check_variable = { which = "spell_power" value = "3"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "18"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "slaanesh_lore.2a"
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_sl_Unholy_Screaming" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "5"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "slaanesh_lore.2b"
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_sl_wailing_madness" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "9"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "slaanesh_lore.2c"
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_sl_daemonettes" }
                check_variable = { which = "spell_power" value = "2"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "12"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 2 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "slaanesh_lore.2d"
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_sl_choir" }
                check_variable = { which = "spell_power" value = "3"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "15"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "tzeentch_lore.2a"
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_te_bolt_of_change" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "4"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "tzeentch_lore.2b"
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_te_flames_of_mutation" }
                check_variable = { which = "spell_power" value = "1"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "7"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 1 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        z_spell_process_non_combat = yes
        ai_chance = { factor = 0 }
    }
    option = {
        name = "tzeentch_lore.2c"
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_te_screamers" }
                check_variable = { which = "spell_power" value = "2"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "10"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 2 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }
    option = {
        name = "tzeentch_lore.2d"
        trigger = {
            event_target:magic_caster = {
                is_variable_equal = { which = "action_picked" which = "m_te_twisting_paths" }
                check_variable = { which = "spell_power" value = "3"}
            }
        }
        event_target:magic_caster = {
            set_variable = {which = "spellcast" value = "14"}
            set_variable = { which = dnum value = 0 }
            set_variable = { which = dmin value = 3 }
        }
        character_event =  { id = z_combat_spell_menu.3}
        ai_chance = { factor = 0 }
    }


    option = {
        name = "CANCEL_CASTING"
        event_target:magic_caster = {
            clr_character_flag = casting
            clr_character_flag = casting_non_combat
            clr_character_flag = casting_combat
            character_event = { id = magic_system.99997 }
        }
        ai_chance = { factor = 1 }
    }
}



character_event = {
    id = z_combat_spell_menu.3
    title = z_combat_spell_menu.3
    desc = "z_combat_spell_menu.3_desc"
    picture = "GFX_evt_mage_choose_lore"
    is_triggered_only = yes
    trigger = {
        event_target:magic_caster = {
            is_alive = yes
        }
    }

    option = {
        trigger = {
            event_target:magic_caster = {
                check_variable = { which = spell_power value = 1}
            }
        }
        name = "Expend Additional Power Dice"
        custom_tooltip = {
            text = "By investing time, you generate a random amount of magic points."
        }
        event_target:magic_caster = {
            change_variable = { which = "dnum" value = "1"}
            change_variable = { which = "spell_power" value = "-1"}
            character_event = { id = z_combat_spell_menu.3 }
        }
    }
    option = {
        trigger = {
            event_target:magic_caster = {
                check_variable = { which = spell_power value = 2}
            }
        }
        name = "Expend Additional Power Dice +2"
        custom_tooltip = {
            text = "By investing time, you generate a random amount of magic points."
        }
        event_target:magic_caster = {
            change_variable = { which = "dnum" value = "2"}
            change_variable = { which = "spell_power" value = "-2"}
        }
        character_event = { id = z_combat_spell_menu.3 }
    }
    option = {
        trigger = {
            event_target:magic_caster = {
                check_variable = { which = spell_power value = 3}
            }
        }
        name = "Expend Additional Power Dice +3"
        custom_tooltip = {
            text = "By investing time, you generate a random amount of magic points."
        }
        event_target:magic_caster = {
            change_variable = { which = "dnum" value = "3"}
            change_variable = { which = "spell_power" value = "-3"}
        }
        character_event = { id = z_combat_spell_menu.3 }
    }
    option = {
        name = "Use Power Dice"
        trigger = {
            event_target:magic_caster = {
                check_variable = { which = dnum which = dmin}
            }
        }
        custom_tooltip = {
            text = "By investing time, you generate a random amount of magic points."
        }
        character_event = { id = z_combat_spell_menu.5 }
    }
}


#Combat Magic Dispel/Spell Continue
character_event = {
    id = z_combat_spell_menu.5#Drain Magic Power 1"
    is_triggered_only = yes
    hide_window = yes
    immediate = {
        event_target:magic_caster = {
            spellcastmod_calc = yes
            set_variable = { which = dnum_base which = dnum}
            miscast_test = yes
            dispel_setup_effect = yes
            if = {
                limit = {
                    event_target:magic_caster = {
                        has_character_flag = has_dispel
                    }
                }
                dispel_roll = yes
                event_target:magic_caster = {
                    clr_character_flag = has_dispel
                }
            }
        }
        if = {
            limit = {
                event_target:magic_caster = {
                    NOR = {
                        has_character_flag = dispeled
                        has_character_flag = spell_fail
                    }
                }
            }
            #High Magic
            if = {
                limit = {
                    event_target:magic_caster = {
                        is_variable_equal = { which = action_picked which = "m_hm_drain"}
                    }
                }
                character_event = { id = high_magic_lore.101}
                break = yes
            }
            else_if = {
                limit = {
                    event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_hm_soul_quench"}
                    }
                }
                character_event = { id = high_magic_lore.201}
                break = yes
            }
            else_if = {
                limit = {
                    event_target:magic_caster = {
                        is_variable_equal = { which = action_picked which = "m_hm_apotheoisis"}
                    }
                }
                character_event = { id = high_magic_lore.301}
                break = yes
            }
            else_if = {
                limit = {
                    event_target:magic_caster = {
                        is_variable_equal = { which = action_picked which = "m_hm_firey_convocation"}
                    }
                }
                character_event = { id = high_magic_lore.401}
                break = yes
            }
            #Heavens Lore
            else_if = {
                limit = {
                    event_target:magic_caster = {
                        is_variable_equal = { which = action_picked which = "m_he_foresight"}
                    }
                }
                character_event = { id = heavens_lore.101}
                break = yes
            }
            else_if = {
                limit = {
                    event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_he_urannons_thunderbolt"}
                        }
                    }
                    character_event = { id = heavens_lore.201}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_he_chain_lightning"}
                        }
                    }
                    character_event = { id = heavens_lore.301}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_he_comet"}
                        }
                    }
                    character_event = { id = heavens_lore.401}
                    break = yes
                }
                #Beasts Lore
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_bt_wrath_of_the_wild"}
                        }
                    }
                    character_event = { id = beasts_lore.101}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_bt_beasts_gone_wild"}
                        }
                    }
                    character_event = { id = beasts_lore.201}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_bt_beasts_of_the_wild"}
                        }
                    }
                    character_event = { id = beasts_lore.301}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_bt_amber_spear"}
                        }
                    }
                    character_event = { id = beasts_lore.401}
                    break = yes
                }
                #Fire Lore
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_fi_fireball"}
                        }
                    }
                    character_event = { id = fire_lore.101}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_fi_burning_blade"}
                        }
                    }
                    character_event = { id = fire_lore.201}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_fi_blast_of_flame"}
                        }
                    }
                    character_event = { id = fire_lore.301}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_fi_firestorm"}
                        }
                    }
                    character_event = { id = fire_lore.401}
                    break = yes
                }
                #Death Lore
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_dt_lore_death_bolt"}
                        }
                    }
                    character_event = { id = death_lore.101}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_dt_lore_ward_of_death"}
                        }
                    }
                    character_event = { id = death_lore.201}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_dt_lore_deaths_majesty"}
                        }
                    }
                    character_event = { id = death_lore.301}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_dt_lore_black_sphere"}
                        }
                    }
                    character_event = { id = death_lore.401}
                    break = yes
                }
                #Life Lore
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_lf_grasping_vine"}
                        }
                    }
                    character_event = { id = life_lore.101}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_lf_Life_blossom"}
                        }
                    }
                    character_event = { id = life_lore.201}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_lf_Overgrowth"}
                        }
                    }
                    character_event = { id = life_lore.301}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_lf_resurrection"}
                        }
                    }
                    character_event = { id = life_lore.401}
                    break = yes
                }
                #Metal Lore
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_mt_flesh_to_gold"}
                        }
                    }
                    character_event = { id = metal_lore.101}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_mt_weight_of_iron"}
                        }
                    }
                    character_event = { id = metal_lore.201}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_mt_Curse_of_Rust"}
                        }
                    }
                    character_event = { id = metal_lore.301}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_mt_blessings_of_steel"}
                        }
                    }
                    character_event = { id = metal_lore.401}
                    break = yes
                }
                #Shadows Lore
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_sh_shadow_bolt"}
                        }
                    }
                    character_event = { id = shadows_lore.101}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_sh_steed_of_shadows"}
                        }
                    }
                    character_event = { id = shadows_lore.201}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_sh_mortal_terror"}
                        }
                    }
                    character_event = { id = shadows_lore.301}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_sh_wave_of_darkness"}
                        }
                    }
                    character_event = { id = shadows_lore.401}
                    break = yes
                }
                #light Lore
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_li_holy_fire"}
                        }
                    }
                    character_event = { id = light_lore.101}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_li_speed_of_light"}
                        }
                    }
                    character_event = { id = light_lore.201}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_li_Wall_of_light"}
                        }
                    }
                    character_event = { id = light_lore.301}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_li_Light_of_the_Heavens"}
                        }
                    }
                    character_event = { id = light_lore.401}
                    break = yes
                }
                # Dhar
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_dm_doombolt"}
                        }
                    }
                    character_event = { id = dark_magic_lore.101}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_dm_dark_fury"}
                        }
                    }
                    character_event = { id = dark_magic_lore.201}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_dm_bladewind"}
                        }
                    }
                    character_event = { id = dark_magic_lore.301}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_dm_black_horror"}
                        }
                    }
                    character_event = { id = dark_magic_lore.401}
                    break = yes
                }

                #Ruin
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_ru_warp_lightning"}
                        }
                    }
                    character_event = { id = ruin_lore.101}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_ru_cracks_of_doom"}
                        }
                    }
                    character_event = { id = ruin_lore.201}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_ru_Breath_of_Pestilence"}
                        }
                    }
                    character_event = { id = ruin_lore.301}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_ru_Vermintide"}
                        }
                    }
                    character_event = { id = ruin_lore.401}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_ru_13_spell"}
                        }
                    }
                    character_event = { id = ruin_lore.501}
                    break = yes
                }
                #Necromancy
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_ne_imbide_life"}
                        }
                    }
                    character_event = { id = necromancy_lore.101}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_ne_unholy_life"}
                        }
                    }
                    character_event = { id = necromancy_lore.201}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_ne_unholy_resolve"}
                        }
                    }
                    character_event = { id = necromancy_lore.301}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_ne_damnation_of_the_dead"}
                        }
                    }
                    character_event = { id = necromancy_lore.401}
                    break = yes
                }
                #orc_lore
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_or_eare_we_go"}
                        }
                    }
                    character_event = { id = orc_lore.101}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_or_sneaky_stabbin"}
                        }
                    }
                    character_event = { id = orc_lore.201}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_or_morkll_fix_it"}
                        }
                    }
                    character_event = { id = orc_lore.301}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_or_foot_of_gork"}
                        }
                    }
                    character_event = { id = orc_lore.401}
                    break = yes
                }
                #Slaanesh
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_sl_Unholy_Screaming"}
                        }
                    }
                    character_event = { id = slaanesh_lore.101}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_sl_wailing_madness"}
                        }
                    }
                    character_event = { id = slaanesh_lore.201}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_sl_daemonettes"}
                        }
                    }
                    character_event = { id = slaanesh_lore.301}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_sl_choir"}
                        }
                    }
                    character_event = { id = slaanesh_lore.401}
                    break = yes
                }
                #Tzeeentch
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_te_bolt_of_change"}
                        }
                    }
                    character_event = { id = tzeentch_lore.101}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_te_flames_of_mutation"}
                        }
                    }
                    character_event = { id = tzeentch_lore.201}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_te_screamers"}
                        }
                    }
                    character_event = { id = tzeentch_lore.301}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_te_twisting_paths"}
                        }
                    }
                    character_event = { id = tzeentch_lore.401}
                    break = yes
                }
                #Nurgle
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_nu_bolt_of_rot"}
                        }
                    }
                    character_event = { id = nurgle_lore.101}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_nu_embrace"}
                        }
                    }
                    character_event = { id = nurgle_lore.201}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_nu_Plague_bearers"}
                        }
                    }
                    character_event = { id = nurgle_lore.301}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_nu_Maw_of_disease"}
                        }
                    }
                    character_event = { id = nurgle_lore.401}
                    break = yes
                }
                #Ice Lore
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_ie_1"}
                        }
                    }
                    character_event = { id = ice_lore.101}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_ie_2"}
                        }
                    }
                    character_event = { id = ice_lore.201}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_ie_3"}
                        }
                    }
                    character_event = { id = ice_lore.301}
                    break = yes
                }
                else_if = {
                    limit = {
                        event_target:magic_caster = {
                            is_variable_equal = { which = action_picked which = "m_ie_4"}
                        }
                    }
                    character_event = { id = ice_lore.401}
                    break = yes
                }
        }
        z_spell_process_non_combat = yes
    }
}
